<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lake Tuz</title>

    <!-- Google Font: DM Serif Display -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'serif': ['DM Serif Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js"></script>

</head>

<body class="h-screen text-white" style="background-color: color(display-p3 0.05 0.05 0.05);">
    <section class="screen1 h-screen relative flex justify-center items-center">
        <canvas class="glitch-canvas h-full w-auto filter saturate-200" width="512" height="512"></canvas>
        <div class="flex-grow flex flex-col justify-center items-center text-center p-4">
            <h1 class="text-8xl font-serif m-0" style="color: color(display-p3 1 1 1);">Lake Tuz</h1>
            <h2 class="text-2xl" style="color: color(display-p3 0.9 0.9 0.9);">a lake with thousand <span class="highlight">colors</span></h2>
        </div>
    </section>
    
    <section class="screen2 h-screen flex justify-center items-center p-4 bg-blue-600">
        <div class="text-center">
            <p class="text-2xl text-white">The lake changes its colors due to many factors, including the algea and heliobacteria population in the water.</p>
        </div>
    </section>

    <section class="screen3 h-screen flex justify-center items-center p-4">
        <div class="text-center">
            <h2 class="text-4xl font-serif mb-6" style="color: color(display-p3 1 1 1);">Magical Colors of Lake Tuz</h2>
            <p class="text-lg mb-8" style="color: color(display-p3 0.8 0.8 0.8);">Hover over the cells to see the lake with different colors</p>
            <div id="simple-graph"></div>
        </div>
    </section>

    <section class="screen4 h-screen flex justify-center items-center p-4 bg-green-600">
        <div class="text-center max-w-4xl">
            <h2 class="text-4xl font-serif mb-8" style="color: color(display-p3 1 1 1);">The Science Behind the Colors</h2>
            <div class="space-y-6 text-lg" style="color: color(display-p3 0.8 0.8 0.8);">
                <p>Lake Tuz's remarkable color variations are driven by complex ecological and environmental factors. The lake's hypersaline environment creates unique conditions that support specialized microorganisms.</p>
                <p>During different seasons, the lake transforms through shades of pink, orange, and white as halophilic bacteria and algae populations fluctuate. These microorganisms produce pigments that give the lake its distinctive colors.</p>
                <p>Temperature, salinity levels, and seasonal changes all contribute to this natural color palette, making Lake Tuz one of the most visually dynamic salt lakes in the world.</p>
            </div>
        </div>
    </section>

    <script>
        gsap.registerPlugin(ScrollTrigger, SplitText);

        function imageSequence(config) {
            let playhead = { frame: 0 },
                ctx = gsap.utils.toArray(config.canvas)[0].getContext("2d"),
                onUpdate = config.onUpdate,
                images,
                updateImage = function () {
                    ctx.drawImage(images[Math.round(playhead.frame)], 0, 0);
                    onUpdate && onUpdate.call(this);
                };
            images = config.urls.map((url, i) => {
                let img = new Image();
                img.src = url;
                i || (img.onload = updateImage);
                return img;
            });
            return gsap.to(playhead, {
                frame: images.length - 1,
                ease: "none",
                onUpdate: updateImage,
                scrollTrigger: config.scrollTrigger
            });
        }

        const urls = Array.from({ length: 52 }, (_, i) => `2020/${i + 1}.png`);

        imageSequence({
            urls, // Array of image URLs
            canvas: ".glitch-canvas", // <canvas> object to draw images to
            scrollTrigger: {
                trigger: ".screen1",
                start: "top top",
                end: "+=512",
                scrub: true, // important!
                markers: false,
                pin: true
            }
        });

        // Background color animation for screen2
        gsap.to(".screen2", {
            backgroundColor: "#ec4899", // Pink color
            scrollTrigger: {
                trigger: ".screen2",
                start: "top top",
                end: "bottom top",
                scrub: true,
                pin: true,
                markers: false
            }
        });

        // Simple multi-row graph with real data
        function createSimpleGraph() {
            const graph = document.getElementById('simple-graph');
            graph.innerHTML = '';
            
            const years = [2019, 2020, 2021, 2022, 2023, 2024, 2025];
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            
            // Create month header row
            const monthRow = document.createElement('div');
            monthRow.style.display = 'flex';
            monthRow.style.gap = '8px';
            monthRow.style.alignItems = 'center';
            monthRow.style.justifyContent = 'space-evenly';
            monthRow.style.marginBottom = '8px';
            
            // Add empty space for year labels
            const emptySpace = document.createElement('div');
            emptySpace.style.minWidth = '20px';
            monthRow.appendChild(emptySpace);
            
            // Add month labels (every 4 weeks)
            for (let i = 0; i < 12; i++) {
                const monthLabel = document.createElement('div');
                monthLabel.textContent = months[i];
                monthLabel.style.color = 'white';
                monthLabel.style.fontSize = '12px';
                monthLabel.style.fontWeight = 'bold';
                monthLabel.style.width = '48px'; // 4 weeks * 12px
                monthLabel.style.textAlign = 'center';
                monthRow.appendChild(monthLabel);
            }
            
            graph.appendChild(monthRow);
            
            // Load and use real data
            fetch('text.json')
                .then(response => response.json())
                .then(data => {
                    years.forEach(year => {
                        const row = document.createElement('div');
                        row.style.display = 'flex';
                        row.style.gap = '4px';
                        row.style.alignItems = 'center';
                        row.style.justifyContent = 'center';
                        row.style.marginBottom = '8px';
                        
                        // Add year label
                        const yearLabel = document.createElement('div');
                        yearLabel.textContent = year;
                        yearLabel.style.color = 'white';
                        yearLabel.style.fontSize = '12px';
                        yearLabel.style.fontWeight = 'bold';
                        yearLabel.style.minWidth = '40px';
                        row.appendChild(yearLabel);
                        
                        // Create 52 cells with real colors
                        for (let week = 1; week <= 52; week++) {
                            const cell = document.createElement('div');
                            cell.style.width = '20px';
                            cell.style.height = '20px';
                            cell.style.borderRadius = '4px';
                            
                            // Find data for this year and week
                            const weekData = data.find(item => item.year === year && item.week === week);
                            
                            if (weekData && weekData.color) {
                                // Use real color from the data
                                const { r, g, b } = weekData.color;
                                cell.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                                
                                // Store the filename for tooltip use
                                cell.dataset.filename = weekData.date;
                            } else {
                                // Fallback to white if no data
                                cell.style.backgroundColor = 'white';
                                cell.dataset.filename = 'examples/1.png'; // Default fallback
                            }
                            
                            // Set initial state for animation
                            cell.style.opacity = '0';
                            cell.style.scale = '0.5';
                            
                            // Add tooltip functionality
                            cell.addEventListener('mouseenter', function(e) {
                                // Get or create tooltip
                                let tooltip = document.querySelector('.cell-tooltip');
                                
                                if (!tooltip) {
                                    // Create tooltip if it doesn't exist
                                    tooltip = document.createElement('div');
                                    tooltip.className = 'cell-tooltip';
                                    tooltip.style.cssText = `
                                        position: fixed;
                                        top: ${e.clientY + 10}px;
                                        left: ${e.clientX + 10}px;
                                        z-index: 1000;
                                        pointer-events: none;
                                        background: rgba(0, 0, 0, 0.8);
                                        padding: 20px;
                                        border-radius: 4px;
                                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                                    `;
                                    document.body.appendChild(tooltip);
                                } else {
                                    // Update position if tooltip exists
                                    tooltip.style.top = `${e.clientY + 10}px`;
                                    tooltip.style.left = `${e.clientX + 10}px`;
                                }
                                
                                // Update image source
                                const img = tooltip.querySelector('img') || document.createElement('img');
                                img.src = `selected/${cell.dataset.filename}` || 'examples/1.png';
                                img.style.cssText = `
                                    width: 250px;
                                    height: 250px;
                                    object-fit: cover;
                                    border-radius: 4px;
                                    filter: saturate(2);
                                `;
                                
                                // Add image to tooltip if not already there
                                if (!tooltip.querySelector('img')) {
                                    tooltip.appendChild(img);
                                }
                                
                                // Add date text below image
                                const dateText = tooltip.querySelector('.date-text') || document.createElement('div');
                                dateText.className = 'date-text';
                                dateText.textContent = cell.dataset.filename ? cell.dataset.filename.replace('.png', '') : 'Unknown Date';
                                dateText.style.cssText = `
                                    color: white;
                                    font-size: 14px;
                                    text-align: center;
                                    margin-top: 10px;
                                    font-weight: 500;
                                `;
                                
                                if (!tooltip.querySelector('.date-text')) {
                                    tooltip.appendChild(dateText);
                                }
                            });
                            
                            // Update tooltip position on mousemove
                            cell.addEventListener('mousemove', function(e) {
                                const tooltip = document.querySelector('.cell-tooltip');
                                if (tooltip) {
                                    tooltip.style.top = `${e.clientY + 10}px`;
                                    tooltip.style.left = `${e.clientX + 10}px`;
                                }
                            });
                            
                            // Add mouseleave event listener to the graph container
                            const graph = document.getElementById('simple-graph');
                            graph.addEventListener('mouseleave', function() {
                                const tooltip = document.querySelector('.cell-tooltip');
                                if (tooltip) {
                                    tooltip.remove();
                                }
                            });
                            
                            row.appendChild(cell);
                        }
                        
                        graph.appendChild(row);
                    });
                    
                    // Animate all cells with GSAP and ScrollTrigger
                    const allCells = graph.querySelectorAll('div[style*="width: 20px"]');
                    gsap.fromTo(allCells, 
                        {
                            opacity: 0,
                            scale: 0.5
                        },
                        {
                            opacity: 1,
                            scale: 1,
                            duration: 0.6,
                            stagger: 0.02,
                            ease: "back.out(1.7)",
                            scrollTrigger: {
                                trigger: graph,
                                start: "top bottom",
                                end: "center center",
                                scrub: 1,
                                toggleActions: "play none none reverse",
                                markers: false
                            }
                        }
                    );
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    // Fallback to random colors if data fails to load
                    years.forEach(year => {
                        const row = document.createElement('div');
                        row.style.display = 'flex';
                        row.style.gap = '4px';
                        row.style.alignItems = 'center';
                        row.style.justifyContent = 'center';
                        row.style.marginBottom = '8px';
                        
                        const yearLabel = document.createElement('div');
                        yearLabel.textContent = year;
                        yearLabel.style.color = 'white';
                        yearLabel.style.fontSize = '12px';
                        yearLabel.style.fontWeight = 'bold';
                        yearLabel.style.minWidth = '40px';
                        row.appendChild(yearLabel);
                        
                        for (let i = 0; i < 52; i++) {
                            const cell = document.createElement('div');
                            cell.style.width = '12px';
                            cell.style.height = '12px';
                            cell.style.borderRadius = '2px';
                            cell.style.backgroundColor = 'white';
                            row.appendChild(cell);
                        }
                        
                        graph.appendChild(row);
                    });
                });
        }
        
        document.addEventListener('DOMContentLoaded', createSimpleGraph);

    </script>
</body>

</html>